
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../diagnose-crashed-apiserver/">
      
      
        <link rel="next" href="../vi-101/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.10">
    
    
      
        <title>YAML FAQ - CKA Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yaml-faq" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CKA Notes" class="md-header__button md-logo" aria-label="CKA Notes" data-md-component="logo">
      
  <img src="../../img/CKA-img.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CKA Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              YAML FAQ
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/AlbinB97/CKA-Notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    AlbinB97/CKA-Notes
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CKA Notes" class="md-nav__button md-logo" aria-label="CKA Notes" data-md-component="logo">
      
  <img src="../../img/CKA-img.png" alt="logo">

    </a>
    CKA Notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/AlbinB97/CKA-Notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    AlbinB97/CKA-Notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Commands
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/WIP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WIP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/imperative/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Imperative
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/crictl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crictl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Information
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../etcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Etcd FAQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../diagnose-crashed-apiserver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diagnose Crashed Apiserver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    YAML FAQ
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    YAML FAQ
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#in-a-nutshell" class="md-nav__link">
    <span class="md-ellipsis">
      In a nutshell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-quote-or-not-to-quote" class="md-nav__link">
    <span class="md-ellipsis">
      To quote or not to quote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indentation" class="md-nav__link">
    <span class="md-ellipsis">
      Indentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-errors-kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with errors (kubectl)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gotchas" class="md-nav__link">
    <span class="md-ellipsis">
      Gotchas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yaml-practice-lab" class="md-nav__link">
    <span class="md-ellipsis">
      YAML practice lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documents" class="md-nav__link">
    <span class="md-ellipsis">
      Documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aliases-and-anchors" class="md-nav__link">
    <span class="md-ellipsis">
      Aliases and Anchors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../vi-101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vi 101
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#in-a-nutshell" class="md-nav__link">
    <span class="md-ellipsis">
      In a nutshell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-quote-or-not-to-quote" class="md-nav__link">
    <span class="md-ellipsis">
      To quote or not to quote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indentation" class="md-nav__link">
    <span class="md-ellipsis">
      Indentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-errors-kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with errors (kubectl)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gotchas" class="md-nav__link">
    <span class="md-ellipsis">
      Gotchas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yaml-practice-lab" class="md-nav__link">
    <span class="md-ellipsis">
      YAML practice lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documents" class="md-nav__link">
    <span class="md-ellipsis">
      Documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aliases-and-anchors" class="md-nav__link">
    <span class="md-ellipsis">
      Aliases and Anchors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="yaml-faq">YAML FAQ</h1>
<p>Source: <a href="https://github.com/kodekloudhub/community-faq/blob/main/docs/yaml-faq.md">https://github.com/kodekloudhub/community-faq/blob/main/docs/yaml-faq.md</a></p>
<p>We see a few questions about "kubectl" YAML manifests and what you can and can't do syntactically, therefore we'll try to clear some of this up.</p>
<p><code>kubectl</code> (and anything else in the ecosystem that needs to read YAML like <code>kubelet</code> etc) is built using the standard GoLang YAML package, which apart from anything explicitly mentioned in the package's <a href="https://github.com/go-yaml/yaml#compatibility">Compatibility</a> paragraph is generally YAML 1.2 compliant (see <a href="#gotchas">gotchas</a> below), and this is the dialect that <code>kubectl</code> understands. There is no "special" <code>kubectl</code> dialect.</p>
<ul>
<li><a href="#in-a-nutshell">In a nutshell</a></li>
<li><a href="#to-quote-or-not-to-quote">To quote or not to quote</a></li>
<li><a href="#indentation">Indentation</a></li>
<li><a href="#dealing-with-errors-kubectl">Dealing with Errors (kubectl)</a></li>
<li><a href="#gotchas">Gotchas</a></li>
<li><a href="#yaml-practice-lab">YAML Practice lab</a></li>
<li><a href="#advanced-features">Advanced features</a><ul>
<li><a href="#documents">Documents</a></li>
<li><a href="#aliases-and-anchors">Aliases and anchors</a></li>
</ul>
</li>
</ul>
<h2 id="in-a-nutshell">In a nutshell</h2>
<p>YAML is a superset of JSON and has all the same concepts like objects (a.k.a. dictionary, map) and lists, and combinations of all these</p>
<pre><code class="language-yaml">myString: I am a string value
myNumber: 123
myBoolean: true
myList:
- value1
- value2
- valuen
myObject:           # Every key-value indented beneath here is part of `myObject` dictionary
  property1: value1
  property2: value2
  propertyn: valuen
</code></pre>
<p>Every item is a key-value pair, where the key name ends with a <code>:</code> and the value follows.</p>
<p>A value may be of any valid type; a scalar (string, number, bool etc.), or a list or another object, so <code>value1</code>, <code>value2</code>, <code>valuen</code> above can be any of these types, however here they are string literals.</p>
<p>This is exactly the same as this JSON</p>
<pre><code class="language-json">{
    &quot;myString&quot;: &quot;I am a string value&quot;,
    &quot;myNumber&quot;: 123,
    &quot;myBoolean&quot;: true,
    &quot;myList&quot;: [
        &quot;value1&quot;,
        &quot;value2&quot;,
        &quot;valuen&quot;
    ],
    &quot;myObject&quot;: {
        &quot;property1&quot;: &quot;value1&quot;,
        &quot;property2&quot;: &quot;value2&quot;,
        &quot;propertyn&quot;: &quot;valuen&quot;
    }
}
</code></pre>
<p>Any valid JSON is also valid YAML, meaning you can mix and match</p>
<pre><code class="language-yaml"># Using JSON array for command parameters (known as YAML flow style)
command: [&quot;sleep&quot;, &quot;4800&quot;]
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-yaml"># Using YAML array for command parameters (known as YAML block style)
command:
- sleep
- &quot;4800&quot;
</code></pre>
<p>In places where you need to declare an empty YAML object key, then you must use flow style to represent the value as an empty (JSON) object, such as</p>
<pre><code class="language-yaml">volumes:
- name: my-volume
  emptyDir: {}
</code></pre>
<p>This is because to put nothing after <code>emptyDir:</code> would be a syntax error as the value would be missing. What we are doing is asking for an <code>emptyDir</code> volume with no custom properties. There are properties that could be used with this but they are beyond the scope of the exams.</p>
<h2 id="to-quote-or-not-to-quote">To quote or not to quote</h2>
<p>YAML always parses literal values as strings, <em>unless</em> the value is wholly numeric (including canonical, integer, fixed point, exponential, octal or hex), a timestamp or a boolean (<code>true</code>, <code>false</code>). If you want to force a non-string to be parsed as a string, you must quote it. This rule applies to environment variable values and to command arguments which must both be passed to the underlying container as a string, hence</p>
<pre><code class="language-yaml">command:
- sleep
- &quot;4800&quot;
</code></pre>
<p>If you are creating configmaps or secrets for use with environment variables, the same quoting rules apply.</p>
<p>We've seen posts that say "You must quote mount paths" or "You must quote pod capabilities". This is not the case. The rules are as stated above. At the end of the day you want to use as few keystrokes as possible when doing the exam! You only need to quote in flow-style e.g.</p>
<pre><code class="language-yaml">    securityContext:
      capabilities:
        add: [&quot;NET_ADMIN&quot;, &quot;SYS_TIME&quot;]
</code></pre>
<p>is <em>exactly</em> the same as</p>
<pre><code class="language-yaml">    securityContext:
      capabilities:
        add:
        - NET_ADMIN
        - SYS_TIME
</code></pre>
<h2 id="indentation">Indentation</h2>
<p>Beware of the pesky indentation rules. Whitespace is part of the syntax like Python, however <code>TAB</code> characters are not. Each indentation level should be two spaces. If you mess this up you can get all kinds of different errors from <code>kubectl</code> depending on where it was in the file when it encountered the error.</p>
<p>Lists may be introduced at the same level as the parent key, or indented. Both the following lists are valid</p>
<pre><code class="language-yaml">list1:
- value1

list2:
  - value2
</code></pre>
<ul>
<li>Make sure vim is not inserting <code>TAB</code> instead of spaces, or you will get cryptic errors from <code>kubectl</code>!</li>
<li>Remember to use <code>INSERT (paste)</code> mode when pasting YAML from documentation, and toggle paste mode OFF before hitting tab on the keyboard.</li>
</ul>
<p>The following vim settings in .vimrc work for me, but many people have posted other settings in blogs like Medium.</p>
<pre><code>set nu
set ts=2
set sw=2
set et
set ai
set pastetoggle=&lt;F3&gt;
</code></pre>
<p>What these do, in order:</p>
<ol>
<li>Enable line numbers</li>
<li>Set shift width 2 chars</li>
<li>Expand tabs to spaces</li>
<li>Set tab stop to 2 chars</li>
<li>Enable auto indent</li>
<li>NOTE - this was not working properly in the exam as of 2022-07-06. See <a href="https://github.com/fireflycons/tips-for-CKA-CKAD-CKS#issues-with-the-exam-portal">Issues with Exam Portal</a>.<br>Set F3 key to toggle paste mode. This is super important when pasting from the Kubernetes docs. Enter insert mode <code>i</code> then press <code>F3</code> so the bottom line reads<br><code>INSERT (paste)</code><br>Once you've pasted, ensure to toggle paste mode OFF again, or <code>TAB</code> key will start inserting tab characters and <code>kubectl</code> will complain!</li>
</ol>
<p>Paste mode may also be toggled from vi <a href="https://www.freecodecamp.org/news/vim-editor-modes-explained/">normal mode</a> with the following commands:</p>
<ul>
<li><code>:set paste</code></li>
<li><code>:set nopaste</code></li>
</ul>
<h2 id="dealing-with-errors-kubectl">Dealing with errors (kubectl)</h2>
<p>When a manifest is read, it is a two-pass operation</p>
<ol>
<li>
<p>The YAML is read in and converted to JSON. In this phase, errors specific to the grammar of YAML itself will be detected. If it gets past this phase, then the YAML is syntactically correct <em>as far as YAML grammar goes</em>. These errors have line number context and will be shown as</p>
<p><code>(yaml: line #: error message)</code></p>
<p>You should enable line numbers in <code>vi</code> to help you get to these errors quickly. If line numbers are not showing, enter <code>:set nu</code> into <code>vi</code> before entering insert mode.</p>
<p>If the manifest file being read has <a href="#documents">multiple documents</a>, then the error line number is relative to the beginning of the document currently being read, not the beginning of the file. You can use <a href="../vi-101/#relative-numbers">relative line numbers</a> in vi to get to the correct line of a document further down the manifest file.</p>
</li>
<li>
<p>Once the YAML has successfully been converted to JSON, then the JSON is marshalled to Go structures internally (i.e. the programmatic representation of pods, deployments, etc.). These errors are generally of the form</p>
<p><code>(json: cannot unmarshal _something_ into Go _something_else_ of type _sometype_)</code></p>
<p>This means that you have probably missed a key, or put a list or a string literal where there should have been a map. Basically what you've put for a pod is syntactically correct YAML, but that YAML does not correctly represent a pod.<br/><br/>You can get a clue as to where the error is from the <code>something_else</code>. Say that is <code>PodSpec.spec.containers</code> then it's in the <code>containers:</code> section of the manifest. Say it's <code>Volume.spec.volumes.hostPath</code> then it's a <code>hostPath:</code> within one of your <code>volumes:</code>.</p>
<p>Essentially you have supplied the wrong data type at the manifest path indicated by <em>something_else</em>. You can use this information in a <code>kubectl explain</code> to find out what should be there, so for the above <code>PodSpec.spec.containers</code>:</p>
<ol>
<li>From the <em>something_else</em> omit the first <code>Spec</code> (if present and has capital S), then lowercase what remains, e.g. <code>PodSpec</code> = <code>pod</code>, <code>PersistentVolumeSpec</code> = <code>persistentvolume</code>.</li>
<li>
<p>Make an explain command</p>
<p><code>kubectl explain pod.spec.containers</code></p>
</li>
</ol>
</li>
</ol>
<p>A manifest parse stops at the first error encountered, as it loses context and cannot continue. This means if you have made multiple errors you have to fix one to be able to find the next, therefore getting it right is an iterative process!</p>
<p>Some common errors you'll get from Kubernetes components when your YAML is malformed are shown below. I'm showing the <em>relevant</em> portion of the error messages:</p>
<ul>
<li>
<p>TABs</p>
<p><code>(yaml: line 67: found character that cannot start any token)</code></p>
<p>Usually indicative of <code>TAB</code> characters found where there should be spaces at the given line.</p>
</li>
<li>
<p>Incorrect indention causing map when list is expected</p>
<p><code>(yaml: line 56: mapping values are not allowed in this context)</code></p>
<p>Here the error is caused by</p>
<p><code>yaml
spec:
  containers:
  name: nginx     # &lt;- line 56</code></p>
<p><code>name</code> is not an allowed key for <code>spec</code>, which is how we've put it. <code>name</code> is actually part of a container definition and <code>containers</code> is a <em>list</em> of container defintions. Should have been</p>
<p><code>yaml
spec:
  containers:
  - name: nginx</code>
* Unknown field</p>
<p><code>Error from server (BadRequest): error when creating "some-pod":
Pod in version “v1” cannot be handled as a Pod: strict decoding error: unknown field “spec.containers[0].dnsPolicy”</code></p>
<p>Again, usually an indentation problem (in this case), or it really is a field that doesn't exist e.g. you put <code>foobar</code> or some other nonsense, or you simply typoed the key name.</p>
<p><code>yaml
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: busybox
    name: test
    command:
    - sleep
    - “1800”
    dnsPolicy: ClusterFirst  #&lt;- This is indented too far</code></p>
<p>In the example above <code>dnsPolicy</code> has been indented to be part of the first container (i.e. <code>containers[0]</code>), and as such is an unknown field for a container specification. It should be part of <code>spec</code> for the pod itslf.</p>
</li>
<li>
<p>Could not find expected key</p>
<p><code>(yaml: line 106: did not find expected key)</code></p>
<p>Most likely you inserted a new list item somewhere near the given line, but did not specify it as a list item, e.g.</p>
<p><code>yaml
  volumes:
    hostPath:                    # &lt;- you inserted this volume
      path: /etc/ssl/certs
      type: DirectoryOrCreate
    name: ca-certs
  - hostPath:
      path: /etc/ca-certificates
      type: DirectoryOrCreate
    name: etc-ca-certificates</code></p>
<p>But you forgot the <code>-</code></p>
<p><code>yaml
  volumes:
  - hostPath:                    # &lt;- note the difference
      path: /etc/ssl/certs
      type: DirectoryOrCreate
    name: ca-certs
  - hostPath:
      path: /etc/ca-certificates
      type: DirectoryOrCreate
    name: etc-ca-certificates</code></p>
</li>
<li>
<p>Missing list where Kubernetes expects one</p>
<p><code>(json: cannot unmarshal object into Go struct field PodSpec.spec.containers of type []v1.Container)</code></p>
<p>Any unmarshalling error that mentions <code>type []...</code> (doesn't matter what comes after <code>[]</code>) means that a YAML list was expected but not found. In this particular case, it is telling us <code>PodSpec.spec.containers</code>, so it is complaining about the <code>containers:</code> section in your pod defintion not being a list. That means you probably did something like</p>
<p><code>yaml
spec:
  containers:
    name: nginx
    image: nginx</code></p>
<p>When it should be</p>
<p><code>yaml
spec:
  containers:
  - name: nginx
    image: nginx</code></p>
</li>
<li>
<p>Missing map where Kubernetes expects one</p>
<p><code>(json: cannot unmarshal string into Go struct field Volume.spec.volumes.hostPath of type v1.HostPathVolumeSource)</code></p>
<p>In this case, the error is caused by</p>
<p><code>yaml
volumes:
- hostPath: /tmp</code></p>
<p>We have specified a string <code>/tmp</code> for the value of <code>hostPath</code> when a YAML map is expected. These are represented as Go <code>struct</code> internally.</p>
<p>It should have been</p>
<p><code>yaml
volumes:
- hostPath:
    path: /tmp</code></p>
</li>
<li>
<p>Argument error</p>
<p>The YAML is correct. The spec structure is correct after it's been converted to JSON and marshalled, however the argument to a spec property is invalid.</p>
<p>For instance, you've created a <code>volume</code> with type <code>File</code> or <code>Directory</code> which means that the indicated path must exist. If it does not, you will get an error similar to</p>
<p><code>Error: MountVolume.SetUp failed for volume "audit" (UniqueName: "kubernetes.io/host-path/5a5fb26ce98b248d1257ea78eeb44853-audit") pod "kube-apiserver-controlplane" (UID: "5a5fb26ce98b248d1257ea78eeb44853") : hostPath type check failed: /etc/kubernetes/dev-audit.yaml is not a file</code></p>
</li>
</ul>
<p>In general the categories of error fall under</p>
<ul>
<li>Incorrect indentation</li>
<li>Misspelled or missing key</li>
<li>Array when it should have been map</li>
<li>Map when it should have been array</li>
<li>Argument errors</li>
</ul>
<p><strong>EXAM TIP</strong></p>
<p>While debugging a YAML file, have <code>vi</code> open in one terminal window and the command prompt in another. With each edit, save the file without exiting <code>vi</code>, using <code>:w</code>. Then in the other terminal run <code>kubectl create</code> or <code>kubectl apply</code> as appropriate until the command is successful. Then exit <code>vi</code>.</p>
<h2 id="gotchas">Gotchas</h2>
<p>Here we list any bugs in the GoLang YAML parser. By "bugs" we mean deviations from the <a href="https://yaml.org/spec/1.2.2">YAML 1.2 Standard</a>, whereby the parser does not behave as per the specification. These are traps for the unwary!</p>
<ul>
<li>
<p>Key duplication is not reported as an error.</p>
<p>As per section <a href="https://yaml.org/spec/1.2.2/#3213-node-comparison">3.2.1.3</a>, a duplicate key should be reported as an error. Golang's parser (and thus <code>kubectl</code>) does not do this. Consider the following. Can you see the issue, and predict what will happen?</p>
<p><code>yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: test
  name: test
spec:
  volumes:
  - name: data
    emptyDir: {}
  containers:
  - image: nginx
    name: test
    resources:
      requests:
        cpu: 200m
    volumeMounts:
    - name: data
      mountPath: /data
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always</code></p>
<ul>
<li>What's wrong with the above?</li>
</ul>
<p><details>
  <summary>Reveal</summary></p>
<p><code>resources:</code> is defined twice. This should be reported as an error, but is not!</p>
</details>
<ul>
<li>What will happen?</li>
</ul>
<p><details>
  <summary>Reveal</summary></p>
<p>The last value found for <code>resources</code> is what will go into the pod, therefore you may <em>think</em> you set a CPU request, but in fact it will <em>not</em> be set, and if that's for an exam question, then it won't score!</p>
<p>Try creating a pod from the above, and get it back with</p>
<p><code>kubectl get pod test -o yaml</code></p>
<p>and note the lack of resources!</p>
<p>Could be any key, and the one which is most likely to nip you (especially if you're doing CKS) would be <code>securityContext</code> which can be defined at container and pod level. If you do a container <code>securityContext</code>, then a pod one later in the manifest and get the indentation wrong, it would be interpreted as a second entry at container level and trump the first one.</p>
</details>
</li>
</ul>
<h2 id="yaml-practice-lab">YAML practice lab</h2>
<p>A lecture and practice lab may be found in <a href="https://kodekloud.com/courses/json-path-quiz/">this free course</a>. Note that the lecture is taken from the Ansible course, however all the main concepts of YAML syntax are discussed.</p>
<h2 id="advanced-features">Advanced features</h2>
<p>Note that you are not required to understand this for the exams. This section is provided just to demonstrate the power of YAML if you master it!</p>
<h3 id="documents">Documents</h3>
<p>A single YAML file may contain multiple documents. Each resource in Kubernetes is described by a single document. Multiple documents in the same file are separated by the document separator which is</p>
<pre><code class="language-yaml">---
</code></pre>
<p>This means that you can declare for instance a deployment and a service to expose it in the same YAML file:</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx
  name: nginx
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: nginx
        name: nginx

---

apiVersion: v1
kind: Service
metadata:
  labels:
    app: nginx
  name: nginx
  namespace: default
spec:
  ports:
  - port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    app: nginx
  type: ClusterIP

</code></pre>
<h3 id="aliases-and-anchors">Aliases and Anchors</h3>
<p>The GoLang YAML parser supports funky stuff like Aliases and Anchors, which help you to avoid repetition. Consider the case where you have a load of containers in a single pod, and they all require the same environment. You can do this:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: nginx-with-anchors
spec:
  containers:
  - name: c1
    image: nginx:1.14.2
    env: &amp;environment             # &lt;- anchor
    - name: MY_NODE_NAME
      valueFrom:
        fieldRef:
          fieldPath: spec.nodeName
  - name: c2
    image: nginx:1.14.2
    env: *environment             # &lt;- alias (to above anchor)
  - name: c3
    image: nginx:1.14.2
    env: *environment
  - name: c4
    image: nginx:1.14.2
    env: *environment
  - name: c5
    image: nginx:1.14.2
    env: *environment
</code></pre>
<p>Apply this pod, then get it back with</p>
<pre><code class="language-bash">kubectl get pod nginx-with-anchors -o yaml
</code></pre>
<p>You will see that the environment for c1 is replicated to all the other containers. Neat huh?</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
    
  </body>
</html>